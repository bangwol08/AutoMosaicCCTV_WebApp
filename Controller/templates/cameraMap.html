<!DOCTYPE html>
<html lang="ko">
<meta charset="utf-8">
<head>
    <!-- meta data -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>CCTV 동작 감시 모자이크</title>

    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="resources/assets/favicon.ico" />

    <!-- Bootstrap Icons-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />

    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic" rel="stylesheet" type="text/css" />

    <!-- SimpleLightbox plugin CSS-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.css" rel="stylesheet" />

    <!-- VIDEO CDN-->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

    <!-- Core theme CSS (includes Bootstrap)-->
    <link rel ="stylesheet" href ="{{ url_for('static', filename='css/styles.css') }}"/>
    <link rel ="stylesheet" href ="{{ url_for('static', filename='css/bootstrap.min.css') }}"/>

    <!-- jquery_inlcude -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- 사용자CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/video.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/videosort.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/nav.css') }}">

    <!-- 사용자 JS -->
    <script src="{{ url_for('static', filename='js/nav.js') }}"></script>
{#    <script src="{{ url_for('static', filename='js/signup.js') }}"></script>#}
    <script src="{{ url_for('static', filename='js/List.js') }}"></script>

</head>
<body>
<!-- 네비게이션바-->
<nav class="navbar navbar-expand-lg navbar-light fixed-top py-3" id="mainNav">{% include 'nav.html' %}</nav>

<!-- 메인컨텐츠 -->
<main>
    <!-- 컨텐츠 표시 -->
    <div id="myform" class="text-center bg-light text-dark bg-opacity-100 d-inline-block">
        <div class="m-3 p-3">
            <h4 class="mb-3">Camera Map</h4>
            <hr>

            <!-- Camera Map-->
            <div id="map" style="width:100%;height:350px;"></div>
            <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=fc08fff74aefb480cd5e4825d06fe58b"></script>

            <script>
                {#var latitude = {{ latitude }};#}
                {#var longitude = {{ longitude }};#}

                var mapContainer = document.getElementById('map');// 지도를 표시할 div
                mapOption = {
                    center: new kakao.maps.LatLng({{ latitude }}, {{ longitude }}), // 지도의 중심좌표
                    level: 4, // 지도의 확대 레벨
                    mapTypeId : kakao.maps.MapTypeId.ROADMAP // 지도종류
                };

                // 지도를 생성한다
                var map = new kakao.maps.Map(mapContainer, mapOption);

                // 실시간교통 타일 이미지 추가
                map.addOverlayMapTypeId(kakao.maps.MapTypeId.TRAFFIC);

                // 지도에 확대 축소 컨트롤을 생성한다
                var zoomControl = new kakao.maps.ZoomControl();

                // 지도의 우측에 확대 축소 컨트롤을 추가한다
                map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

                // 카메라 위치 데이터를 가져오고 지도에 마커 표시
                fetch('/GetLocation')
                    .then(response => response.json())
                    .then(data => {
                        data.GetLocation.forEach(camera => {
                            var markerPosition = new kakao.maps.LatLng(camera.latitude, camera.longitude);
                            var marker = new kakao.maps.Marker({
                                position: markerPosition,
                                map: map
                            });

                            // 마커 클릭 시 정보 창 표시 (예: 카메라 이름)
                            var infowindow = new kakao.maps.InfoWindow({
                                content: camera.name
                            });

                            kakao.maps.event.addListener(marker, 'click', function() {
                                infowindow.open(map, marker);
                            });
                        });
                    });

                </script>
        </div>
    </div>

</main>
</body>
</html>
